Sub n行挿入する式コピー版()
    '現在の行の上方向にn行挿入する
    '現在の行の上の書式がコピーされる
    '選択セルの上の式がコピーされる（複数選択可）
    'Selection(1)が現在の行となる
    'Selection(1)と同じ行の選択セルの上の式をコピーする
    Dim n As Long
    Dim myRange As Range
    
    If Selection.Address = Selection.EntireRow.Address Then
        MsgBox "行全体が選択されています"
        Exit Sub
    ElseIf Selection.Address = Selection.EntireColumn.Address Then
        MsgBox "列全体が選択されています"
        Exit Sub
    End If

    n = InputBox("挿入する行数を入力して下さい")

    If n >= 1 And n <= 1000000 Then
        Rows(Selection(1).Row & ":" & Selection(1).Row + n - 1).Insert xlShiftDown, xlFormatFromLeftOrAbove
        
        For Each myRange In Selection
            If myRange.Row = Selection(1).Row Then
                Range(Cells(myRange.Row, myRange.Column), Cells(myRange.Row + n - 1, myRange.Column)).FormulaR1C1 _
                = Cells(myRange.Row - 1, myRange.Column).FormulaR1C1
            End If
        Next myRange
    ElseIf n > 1000000 Then
        MsgBox "数値が大きすぎます"
    Else
        MsgBox "1以上の数値を入力して下さい"
    End If
    
End Sub