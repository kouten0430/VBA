Sub 設備停止CSVから月間予定へ転記()
    '転記元と転記先のブックを開いておく
    '転記先の該当月のシートを選択しておく
    '転記元のブックをアクティブにし、カレントリージョンが効く位置でマクロを実行する
    'ローカル的なマクロです
    Dim 行始 As Long
    Dim 行終 As Long
    Dim 列始 As Long
    Dim 列終 As Long
    Dim i As Long
    Dim j As Long
    Dim 開始日時の列番号 As Long
    Dim 終了日時の列番号 As Long
    Dim 実施箇所の列番号 As Long
    Dim 作業内容の列番号 As Long
    Dim 電気所 As String
    Dim 開始日 As Date
    Dim 終了日 As Date
    Dim 作業内容 As String
    Dim 転記元ワークブック名 As String
    Dim 転記先ワークブック名 As String
    Dim 月行 As Long
    Dim 月初 As Long
    Dim 月末 As Long
    Dim 転記先の行 As Long
    
    電気所 = InputBox("転記元の実施個所を入力して下さい")   '実施個所の列で完全一致できる名称とする
    転記先の行 = InputBox("転記先の行番号を数値で入力して下さい")
    
    転記元ワークブック名 = ActiveWorkbook.Name
    転記先ワークブック名 = "2019月間業務計画（保守課）.xlsm"
    月行 = 3    '転記先の日付が入っている行番号
    月初 = 5    '転記先の月初の日付が入っている列番号
    月末 = 35   '転記先の月末の日付が入っている列番号
    
    Application.ScreenUpdating = False

    '---ここから行番号・列番号を取得する処理---
    
    行始 = ActiveCell.CurrentRegion.Row
    行終 = ActiveCell.CurrentRegion.Rows(ActiveCell.CurrentRegion.Rows.Count).Row
    列始 = ActiveCell.CurrentRegion.Column
    列終 = ActiveCell.CurrentRegion.Columns(ActiveCell.CurrentRegion.Columns.Count).Column
    
    For i = 列始 To 列終
        If Cells(行始, i).Value = "調整期間　開始日時" Then
            開始日時の列番号 = i
        ElseIf Cells(行始, i).Value = "調整期間　終了日時" Then
            終了日時の列番号 = i
        ElseIf Cells(行始, i).Value = "実施箇所" Then
            実施箇所の列番号 = i
        ElseIf Cells(行始, i).Value = "作業内容" Then
            作業内容の列番号 = i
        End If
    Next i
    
    '---ここから該当電気所のデータを転記する処理---

    For i = 行始 + 1 To 行終
        If Cells(i, 実施箇所の列番号).Value = 電気所 Then
            開始日 = WorksheetFunction.Floor(Cells(i, 開始日時の列番号).Value, 1)   '時分は切り捨てる
            終了日 = WorksheetFunction.Floor(Cells(i, 終了日時の列番号).Value, 1)   '時分は切り捨てる
            作業内容 = Cells(i, 作業内容の列番号).Value
            
            Cells(i, 実施箇所の列番号).Interior.Color = 65535
            
            Workbooks(転記先ワークブック名).Activate

            For j = 月初 To 月末
                If Cells(月行, j).Value >= 開始日 And Cells(月行, j).Value <= 終了日 And TypeName(Cells(月行, j).Value) = "Date" Then
                    If Cells(転記先の行, j).Value <> "" Then 'セルが空白でなければ改行し、空白であれば改行しない
                        Cells(転記先の行, j).Value = Cells(転記先の行, j).Value & vbLf & 作業内容
                    Else
                        Cells(転記先の行, j).Value = 作業内容
                    End If

                End If
            Next j
            
            Workbooks(転記元ワークブック名).Activate
                
        End If
    Next i

End Sub