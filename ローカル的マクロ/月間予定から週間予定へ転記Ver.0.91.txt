Sub 月間予定から週間予定へ転記()
    '転記元をアクティブにした状態で実行して下さい
    '転記先のシートを選択しておいて下さい
    '休み関連の転記元の内容は、凡例に準じていることが前提です
    '休み関連以外の転記元の内容は、所名・全角スペース・内容となっていることが前提です
    '半自動の入力支援です
    'ローカル的なマクロです
    Dim 日付行 As Long
    Dim 氏名列 As Long
    Dim 転記先ワークブック名 As String
    Dim 転記先シート名 As String
    Dim 転記先日付列 As Long
    Dim 転記先所名列 As Long
    Dim 転記先内容列 As Long
    Dim 転記先行終 As Long
    Dim 巡視色 As Long
    Dim 作業色 As Long
    Dim myRange As Range
    Dim 内容 As String
    Dim 日付 As Date
    Dim 氏名 As String
    Dim 転記先背景色 As Long
    Dim i As Long
    Dim tmp As Long
    Dim 配列 As Variant
    
    '---ここから転記元の日付行他を取得する処理---

    日付行 = 6
    氏名列 = Cells.Find("西村", LookAt:=xlWhole).Column
    
    '---ここから転記先のワークブック名他を取得する処理---
    
    転記先ワークブック名 = "2020年度作業予定.xlsx"
    転記先シート名 = Workbooks(転記先ワークブック名).ActiveSheet.Name
    転記先日付列 = 1
    転記先所名列 = 3
    転記先内容列 = 6
    転記先行終 = 999
    巡視色 = 10092543
    作業色 = 13434828
    
    '---ここから転記する処理---
    
    For Each myRange In Selection
        内容 = myRange.Value
        日付 = Cells(日付行, myRange.Column).Value
        
        If 内容 = "創" Or 内容 = "カ" Or 内容 = "特" Or 内容 = "ゆ" Or 内容 = "リ" Or 内容 = "A半" Or 内容 = "P半" Or 内容 = "休" Then  '休み関連の処理
            氏名 = Cells(myRange.Row, 氏名列).Value
            
            For i = 1 To 転記先行終
                If Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先日付列).Value = 日付 _
                And Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先内容列).Value Like "指定休*休暇*" Then
                    On Error GoTo skip
                    tmp = Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells.Find(氏名, LookAt:=xlWhole).Column
                    On Error GoTo 0
                    
                    If 内容 = "休" Then
                        Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, tmp).Value = "○"
                    Else
                        Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, tmp).Value = 内容
                    End If
                    
                    myRange.Interior.Color = 65535  '転記に成功したらセルを黄色にする
                    
skip:
                    
                    Exit For
                    
                End If
            Next i

        Else    '休み関連以外の処理
            If 内容 Like "*巡視*" Then  '作業と巡視で転記先のセルを変える
                転記先背景色 = 巡視色
            Else
                転記先背景色 = 作業色
            End If
            
            For i = 1 To 転記先行終
                If Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先日付列).Value = 日付 _
                And Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先内容列).Value = "" _
                And Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先内容列).Interior.Color = 転記先背景色 Then
                    配列 = Split(内容, "　", 2)
        
                    If 配列(0) = "岩瀬中央" Or 配列(0) = "富山火力" Or 配列(0) = "上滝" Then
                        Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先所名列).Value = 配列(0) & "開閉所"
                    ElseIf 配列(0) = "五百石" Or 配列(0) = "岩瀬" Or 配列(0) = "東富山" Or 配列(0) = "富山" Or 配列(0) = "婦中" Or 配列(0) = "富山移動" Or 配列(0) = "新寺田" Or 配列(0) = "城南" Or 配列(0) = "牛島" Or 配列(0) = "舟橋" Or 配列(0) = "上市" Or 配列(0) = "南富山" Or 配列(0) = "奥田" Or 配列(0) = "中富山" Or 配列(0) = "黒部御前" Or 配列(0) = "富南" Or 配列(0) = "針原" Or 配列(0) = "水橋" Or 配列(0) = "掛尾" Or 配列(0) = "広田" Then
                        Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先所名列).Value = 配列(0) & "変電所"
                    Else
                        Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先所名列).Value = 配列(0)
                    End If
        
                    Workbooks(転記先ワークブック名).Sheets(転記先シート名).Cells(i, 転記先内容列).Value = 配列(1)
                
                    myRange.Interior.Color = 65535  '転記に成功したらセルを黄色にする
                
                    Exit For

                End If
            Next i

        End If

    Next myRange
    
End Sub